---
tags:
  - c语言
---

### 核心定义：以 `\0` 结尾

C 语言中的字符串必须以一个特殊的字符 `\0`（ASCII 值为 0）作为结束标志。

- **作用：** 告诉程序（如 `printf` 函数）字符串在哪里结束。
- **内存占用：** 字符串 `"Hello"` 包含 5 个字母，但在内存中需要 **6 个字节** 的空间（5 个字符 + 1 个 `\0`）。

### 

### 两种常见的声明方式

#### 字符数组 (可修改)

字符串存储在栈（Stack）上。

```c
char str[] = "Hello"; 
// 编译器自动计算长度为 6，并把 'H','e','l','l','o','\0' 放入数组
// 可以修改：str[0] = 'h'; -> 变成 "hello"
```



#### 字符指针 (通常不可修改)

字符串字面量存储在只读数据区（Read-only data segment）。

```c
char *ptr = "Hello";
// 指针 ptr 指向内存中的字符串常量
// 不可修改：ptr[0] = 'h'; -> 可能导致程序崩溃 (Segmentation Fault)
```



### 常用操作 (`<string.h>`)

由于字符串是数组，不能使用 `==` 比较，也不能使用 `+` 拼接，必须使用标准库函数。使用前需包含 `#include <string.h>`。

| **函数**       | **功能**                      | **示例**                                     |
| -------------- | ----------------------------- | -------------------------------------------- |
| **`strlen()`** | 计算字符串长度（不包含 `\0`） | `len = strlen(str);`                         |
| **`strcpy()`** | 复制字符串                    | `strcpy(dest, src);` (需确保 dest 空间足够)  |
| **`strcat()`** | 拼接字符串                    | `strcat(dest, src);` (把 src 接到 dest 后面) |
| **`strcmp()`** | 比较字符串                    | `if(strcmp(s1, s2) == 0)` 表示相等           |



### 输入与输出

- **输出：** 使用 `printf` 和占位符 `%s`。

```c
printf("My string is: %s\n", str);
```

- **输入：**
  - `scanf("%s", str);`：读取字符串，**遇到空格或换行会停止**（不适合读取带空格的句子）。
  - `fgets(str, size, stdin);`：可以读取空格，且能限制长度，防止缓冲区溢出。



### 常见问题

1. **忘记预留 `\0` 的空间：**
   - 错误：`char str[5] = "Hello";` (空间不足，会导致乱码或错误)
   - 正确：`char str[6] = "Hello";` 或让编译器自动计算 `char str[] = "Hello";`
2. **直接比较：** `if (str1 == str2)` 比较的是**内存地址**，而不是内容。比较内容必须用 `strcmp`。



## **`strlen` 和 `sizeof` 区别** 

核心区别：**一个是计算“有效字符长度”的函数，一个是计算“占用内存大小”的运算符。**

| **特性**      | **strlen**                 | **sizeof**                  |
| ------------- | -------------------------- | --------------------------- |
| **本质**      | **函数** (Function)        | **运算符** (Operator)       |
| **头文件**    | 需要 `#include <string.h>` | 不需要 (C 语言内置关键字)   |
| **计算时机**  | **运行阶段** (Run-time)    | **编译阶段** (Compile-time) |
| **计算内容**  | 字符串的**字符个数**       | 变量/类型占用的**字节数**   |
| **\0 结尾符** | **不包含**                 | **包含** (如果是字符数组)   |
| **主要用途**  | 获取字符串的逻辑长度       | 获取数据占用的内存空间      |



### 代码实例



#### 字符数组 (自动长度)

```c
char str[] = "Hello";

// strlen 算的是 H-e-l-l-o，共 5 个字符
int len = strlen(str);   // 结果：5

// sizeof 算的是 H-e-l-l-o-\0，共 6 个字节
int size = sizeof(str);  // 结果：6
```



#### 固定大小的字符数组

即使字符串很短，`sizeof` 也会返回整个数组分配的大小。

```c
char str[100] = "Hello";

// 依然只算有效字符，遇到 \0 就停
int len = strlen(str);   // 结果：5

// 数组总共分配了 100 字节，不论里面装了多少字
int size = sizeof(str);  // 结果：100
```



#### 字符指针

指针用 `sizeof`，得到的只是**指针变量本身的大小**，而不是它指向的字符串长度。[[单目操作符#^948eb7|sizeof计算变量类型的大小]]

```c
char *ptr = "Hello";

// 指针指向的内容长度，依然是 5
int len = strlen(ptr);   // 结果：5

// 这里算的是指针 ptr 本身的大小
// 32位系统通常是 4，64位系统通常是 8
int size = sizeof(ptr);  // 结果：8 (假设是64位系统)
```



### 总结

- **什么时候用 `strlen`？**
  - 需要知道**用户实际输入了多少字符**，或者需要遍历字符串进行处理（如拼接、查找）时。
- **什么时候用 `sizeof`？**
  - 需要分配内存（`malloc`）、清空内存（`memset`）或计算数组总容量时。

**常见错误：** 在函数传参时，数组会退化为指针。[[数组#^29dcc1|数组的退化]]

```c
void func(char s[]) {
    // 此时 s 已经退化为指针
    printf("%d", sizeof(s)); // 结果是 8 (指针大小)，而不是数组大小
}
```



## 其余常用函数

### 字符串复制

#### `strcpy` (String Copy)

将源字符串复制到目标缓冲区中（包括 `\0`）。

- **用法：** `char *strcpy(char *dest, const char *src);`
- **注意：** 目标空间 `dest` 必须足够大，否则会导致**缓冲区溢出（Buffer Overflow）**

#### `strncpy` (String N Copy)

更安全的版本，限制复制的字符数量。

- **用法：** `char *strncpy(char *dest, const char *src, size_t n);`
- **示例：**

```c
char src[] = "Hello World";
char dest[20];

strcpy(dest, src);          // dest 变为 "Hello World"
strncpy(dest, src, 5);      // 只复制前5个字符，dest 变为 "Hello" (注意：可能需要手动补 \0)
dest[5] = '\0';             // 手动添加结束符
```



### 字符串拼接

#### `strcat` (String Concatenate)

将源字符串拼接到目标字符串的**末尾**。

- **用法：** `char *strcat(char *dest, const char *src);`
- **注意：** `dest` 必须有足够的剩余空间来容纳拼接后的新字符串。

#### `strncat` (String N Concatenate)

限制拼接的字符数量，防止溢出。

- **用法：** `char *strncat(char *dest, const char *src, size_t n);`
- **示例：**

```c
char dest[20] = "Hello";
char src[] = " World";

strcat(dest, src); // dest 变为 "Hello World"
```



### 字符串比较

> **关键点：** 在C语言中，**不能**直接用 `==` 来比较两个字符串的内容（那样比较的是地址）。必须使用 `strcmp`。

#### `strcmp` (String Compare)

比较两个字符串的内容。

- **用法：** `int strcmp(const char *str1, const char *str2);`
- **返回值：**

| **返回值** | **含义**                           |
| ---------- | ---------------------------------- |
| **0**      | **两个字符串相等**                 |
| **< 0**    | `str1` 小于 `str2` (按ASCII码顺序) |
| **> 0**    | `str1` 大于 `str2` (按ASCII码顺序) |

#### `strncmp` (String N Compare)

只比较前 `n` 个字符。

- **示例：**

```c
char s1[] = "Apple";
char s2[] = "Banana";

if (strcmp(s1, s2) == 0) {
    printf("相等");
} else {
    printf("不相等"); // 输出不相等
}
```



### 字符串查找

#### `strchr` (String Character)

查找字符在字符串中**第一次**出现的位置。

- **用法：** `char *strchr(const char *str, int c);`
- **返回值：** 返回指向该字符的指针，如果找不到返回 `NULL`。

#### `strstr` (String String)

查找子串在字符串中**第一次**出现的位置。

- **用法：** `char *strstr(const char *haystack, const char *needle);`
- **示例：**

```c
char str[] = "Learning C is fun";
char *ptr = strstr(str, "C is"); // ptr 指向 "C is fun" 的起始位置
```



### 其它常用函数

- **`printf` (stdio.h):** 格式化输出到字符串。
  - *用途：* 将整数、浮点数转换成字符串，或者构造复杂的字符串。
  - *代码：* `sprintf(buffer, "Score: %d", 100);` -> buffer 内容变为 "Score: 100"。[[sprintf函数使用示例]]
- **`atoi` / `atof` (stdlib.h):** 字符串转数字。
  - *代码：* `int val = atoi("123");` -> val 变为整数 123。

------

### 总结

1. **安全性优先：**尽量使用带 `n` 的函数（如 `strncpy`, `strncmp`），以防止内存越界。
2. **记得 `\0`：** 在分配内存或手动操作字符数组时，不要忘记为末尾的空字符留出空间。

3. 所有的字符串处理函数（如 `printf`, `strlen`, `strcmp`）都是**遇到第一个 `\0` 就停止**。所以逻辑上`str1`的数据被覆盖，但物理上数据还存在。
